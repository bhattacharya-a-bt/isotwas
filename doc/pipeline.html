<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Train an isoTWAS model</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Train an isoTWAS model</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This module will cover how to use functions from <code>isotwas</code>
to train an multivariate <code>isotwas</code> model for isoform-level
expression. Along the way, we’ll be covering some practical
considerations for computation and feature selection.</p>
</div>
<div id="train-predictive-model" class="section level2">
<h2>Train predictive model</h2>
<p>To train a multivariate model, we need:</p>
<ol style="list-style-type: decimal">
<li><p>a matrix of dosages of SNPs, and</p></li>
<li><p>a matrix of isoform-level expressions for a given gene.</p></li>
</ol>
<p>Isoform expression estimated from pseudo-alignment methods like <a href="https://combine-lab.github.io/salmon/"><code>salmon</code></a> and
<a href="https://pachterlab.github.io/kallisto/"><code>kallisto</code></a>
provide bootstrapped estimates expression across a number of iterations.
This information can be included into model training, as illustrated
below.</p>
<p><u><strong>Practical consideration</strong></u>: Ideally, to reduce
your memory usage, we recommend storing your genetic data as
<code>PLINK</code> format data (ideally as
<code>.bed</code>/<code>bim</code>/<code>fam</code> or
<code>.pgen</code>/<code>.pvar</code>/<code>.psam</code>). For a given
gene, use <code>PLINK</code> to <a href="https://www.cog-genomics.org/plink/2.0/filter">select only
SNPs</a> on the same chromosome and within 1 Megabase of the gene body.
Then, you can use the <a href="https://privefl.github.io/bigsnpr/"><code>bigsnpr</code>
package</a> read in this “condensed” file set. Make sure your isoform
expression matrix is log-transformed and residualized by covariates that
are normally used in a QTL analysis (i.e., age, sex, principal
components of the genotype matrix, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3398141/">PEER
factors</a> or <a href="https://pubmed.ncbi.nlm.nih.gov/23874524/">hidden covariates with
prior</a> for the full expression matrix). In order to ensure maximal
overlap between the model and the GWAS we will eventually use for trait
mapping, we suggest restricting the SNPs in the QTL panel to only those
present in the LD reference panel or to those annotated by the <a href="https://www.nature.com/articles/nature02168">HapMap3 Project</a>.
This will ensure proper standard error calculations.</p>
<p>For this vignette about training an model, we’ll use some toy genetic
and transcriptomic data provided.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>train_bed <span class="ot">=</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;train.bed&quot;</span>, <span class="at">package =</span> <span class="st">&quot;isotwas&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>snps <span class="ot">=</span> bigsnpr<span class="sc">::</span><span class="fu">snp_attach</span>(bigsnpr<span class="sc">::</span><span class="fu">snp_readBed2</span>(train_bed,</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>                                                 <span class="at">backingfile =</span> <span class="fu">tempfile</span>()))</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">dim</span>(snps<span class="sc">$</span>genotypes[])</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#&gt; [1]  300 4542</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>isoform_mat <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;isoform_exp.RDS&quot;</span>, <span class="at">package =</span> <span class="st">&quot;isotwas&quot;</span>))</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">dim</span>(isoform_mat)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#&gt; [1] 300   3</span></span></code></pre></div>
<p>This reads in a SNP matrix with dimensions <span class="math inline">\(300 \times 4542\)</span>, with samples along the
rows and SNPs along the columns and a isoform-level expression matrix of
dimension <span class="math inline">\(300 \times 3\)</span>, with
isoforms along the columns.</p>
<p><u><strong>Practical consideration</strong></u>: Though this is not a
requirement for the isotwas pipeline, we recommend a feature selection
step based on cis-heritability of isoform-level expression. Prior of
model training for isoforms of a given gene, we recommend that users
compute the heritability of all expressed isoforms of a gene using <a href="https://yanglab.westlake.edu.cn/software/gcta/#Overview"><code>GCTA</code></a>
(ideally the <a href="http://gusevlab.org/projects/fusion/"><code>gcta-nr-robust</code>
executable in <code>FUSION</code></a>). We recommend users only train
models for isoforms that have positive heritability at nominal <span class="math inline">\(P &lt; 0.05\)</span> or <span class="math inline">\(0.01\)</span>.</p>
<p><u><strong>Practical consideration</strong></u>: Prior to
heritability analysis and model training, it is imperative that your
expression data is residualized by relevant covariates (i.e. principal
components of genotype matrix, hidden covariates or PEER factors of the
expression matrix, clinical/demographic covariates). A general rule of
thumb is if you would include the covariate in an eQTL/isoform-level
eQTL analysis, you should include it in the residualization process.</p>
<p>Let’s jitter our expression matrix a little to generate 10
bootstrapped estimates of the matrix. Keep in mind that these
replicates, theoretically, should not affect the effect size estimates
but will help in seeding the estimation process of the correlation
between isoforms/error in the multivariate model.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>boot_list <span class="ot">=</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="cf">function</span>(i){<span class="fu">jitter</span>(isoform_mat)})</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>isoform_mat_rep <span class="ot">=</span> rlist<span class="sc">::</span><span class="fu">list.rbind</span>(boot_list)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">rownames</span>(isoform_mat_rep) <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">&#39;Sample&#39;</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(snps<span class="sc">$</span>fam)),<span class="dv">10</span>)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">colnames</span>(isoform_mat_rep) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&#39;Isoform&#39;</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(isoform_mat_rep))</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="fu">dim</span>(isoform_mat_rep)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; [1] 3000    3</span></span></code></pre></div>
</div>
<div id="available-prediction-methods" class="section level2">
<h2>Available Prediction Methods</h2>
<p>The <code>compute_isotwas()</code> function supports 9 multivariate
prediction methods:</p>
<table>
<colgroup>
<col width="38%" />
<col width="61%" />
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>mrce_lasso</code></td>
<td>Multivariate Regression with Covariance Estimation (MRCE) - jointly
estimates regression coefficients and error covariance</td>
</tr>
<tr class="even">
<td><code>multi_enet</code></td>
<td>Multivariate elastic net - fits elastic net for each isoform with
shared penalty</td>
</tr>
<tr class="odd">
<td><code>joinet</code></td>
<td>Joinet stacked elastic net - uses cross-predictions to improve
multivariate prediction</td>
</tr>
<tr class="even">
<td><code>spls</code></td>
<td>Sparse partial least squares - finds latent components that predict
all isoforms</td>
</tr>
<tr class="odd">
<td><code>sgl</code></td>
<td>Sparse group lasso - encourages both within-group and across-group
sparsity</td>
</tr>
<tr class="even">
<td><code>mtlasso</code></td>
<td>Multi-task lasso (L21) - joint feature selection across all
isoforms</td>
</tr>
<tr class="odd">
<td><code>stacking</code></td>
<td>Super learner stacking - combines predictions from multiple base
methods</td>
</tr>
<tr class="even">
<td><code>graph_reg</code></td>
<td>Graph-regularized regression - incorporates isoform similarity
structure</td>
</tr>
<tr class="odd">
<td><code>univariate</code></td>
<td>Best of univariate methods (elastic net, BLUP, SuSiE) per
isoform</td>
</tr>
</tbody>
</table>
</div>
<div id="training-a-model" class="section level2">
<h2>Training a Model</h2>
<p>Now, we can train the model using the <code>compute_isotwas()</code>
function. Make sure the SNP matrix has clear labels for the SNP
identifiers that are relevant to your study.</p>
<p>The function now provides detailed progress output by default
(<code>verbose = TRUE</code>), showing:</p>
<ul>
<li>Data summary (samples, SNPs, transcripts)</li>
<li>Method-by-method progress with timing</li>
<li>Per-method R² performance</li>
<li>Final results comparison table</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>snp_mat <span class="ot">=</span> <span class="fu">as.matrix</span>(snps<span class="sc">$</span>genotypes[])</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">colnames</span>(snp_mat) <span class="ot">=</span> snps<span class="sc">$</span>map<span class="sc">$</span>marker.ID</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">rownames</span>(snp_mat) <span class="ot">=</span> snps<span class="sc">$</span>fam<span class="sc">$</span>sample.ID</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co"># Train with all methods (recommended for best model selection)</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>isotwas_model <span class="ot">=</span> <span class="fu">compute_isotwas</span>(</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  <span class="at">X =</span> snp_mat,</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="at">Y =</span> isoform_mat,</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="at">Y.rep =</span> isoform_mat_rep,</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  <span class="at">R =</span> <span class="dv">10</span>,</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">rownames</span>(isoform_mat_rep),</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  <span class="at">omega_est =</span> <span class="st">&#39;replicates&#39;</span>,</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  <span class="at">omega_nlambda =</span> <span class="dv">5</span>,</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  <span class="at">nfolds =</span> <span class="dv">5</span>,</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1789</span>,</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>  <span class="at">run_all =</span> <span class="cn">TRUE</span>,        <span class="co"># Run all 9 methods</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>  <span class="at">return_all =</span> <span class="cn">TRUE</span>      <span class="co"># Return results from all methods</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>)</span></code></pre></div>
<div id="running-specific-methods" class="section level3">
<h3>Running Specific Methods</h3>
<p>If you want to run only specific methods (e.g., for faster
computation), set <code>run_all = FALSE</code> and specify the
methods:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Run only a subset of methods</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>isotwas_model <span class="ot">=</span> <span class="fu">compute_isotwas</span>(</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="at">X =</span> snp_mat,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="at">Y =</span> isoform_mat,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="at">Y.rep =</span> isoform_mat_rep,</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="at">R =</span> <span class="dv">10</span>,</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">rownames</span>(isoform_mat_rep),</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&#39;mrce_lasso&#39;</span>, <span class="st">&#39;multi_enet&#39;</span>, <span class="st">&#39;sgl&#39;</span>, <span class="st">&#39;univariate&#39;</span>),</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  <span class="at">nfolds =</span> <span class="dv">5</span>,</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1789</span>,</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>  <span class="at">run_all =</span> <span class="cn">FALSE</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="using-graph-regularized-regression" class="section level3">
<h3>Using Graph-Regularized Regression</h3>
<p>The <code>graph_reg</code> method can incorporate prior knowledge
about isoform similarity (e.g., shared exon structure). You can create a
similarity matrix from a GTF annotation file:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Create similarity matrix from GTF (based on shared exons)</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>sim_result <span class="ot">=</span> <span class="fu">similarity_from_gtf</span>(</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="at">gtf_path =</span> <span class="st">&quot;gencode.v45.annotation.gtf.gz&quot;</span>,</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="at">gene =</span> <span class="st">&quot;BRCA1&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;jaccard&quot;</span>  <span class="co"># Options: &quot;jaccard&quot;, &quot;overlap_coef&quot;, &quot;binary&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>)</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co"># Use in model training</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>isotwas_model <span class="ot">=</span> <span class="fu">compute_isotwas</span>(</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="at">X =</span> snp_mat,</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  <span class="at">Y =</span> isoform_mat,</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>  <span class="at">Y.rep =</span> isoform_mat_rep,</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>  <span class="at">R =</span> <span class="dv">10</span>,</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">rownames</span>(isoform_mat_rep),</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>  <span class="at">similarity_matrix =</span> sim_result<span class="sc">$</span>similarity_matrix,</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>  <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&#39;multi_enet&#39;</span>, <span class="st">&#39;graph_reg&#39;</span>, <span class="st">&#39;univariate&#39;</span>),</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>  <span class="at">run_all =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1789</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>)</span></code></pre></div>
</div>
</div>
<div id="function-parameters" class="section level2">
<h2>Function Parameters</h2>
<p>A few notes on the key options:</p>
<ul>
<li><p><strong><code>omega_est</code></strong>: By selecting
<code>omega_est = &#39;replicates&#39;</code>, we use the bootstrapped
replicates to estimate the correlation between isoforms. The alternative
is <code>omega_est = &#39;mean&#39;</code>, which will use whatever matrix you
submit for <code>Y</code>.</p></li>
<li><p><strong><code>omega_nlambda</code></strong>: Number of steps
between fully dense to fully sparse in the correlation matrix
estimation. We recommend 5-10 as the default.</p></li>
<li><p><strong><code>method</code></strong>: Vector of methods to use.
By default with <code>run_all = TRUE</code>, all 9 methods are run and
the best model is selected.</p></li>
<li><p><strong><code>similarity_matrix</code></strong>: Optional matrix
for <code>graph_reg</code> method. Can be created using
<code>similarity_from_gtf()</code> or
<code>create_similarity_from_exons()</code>.</p></li>
<li><p><strong><code>predict_nlambda</code></strong>: Number of penalty
variables for <code>mrce_lasso</code>. We recommend 10-20.</p></li>
<li><p><strong><code>alpha</code></strong>: Elastic net mixing parameter
(0 = ridge, 1 = lasso, 0.5 = elastic net).</p></li>
<li><p><strong><code>verbose</code></strong>: If <code>TRUE</code>
(default), prints detailed progress including per-method timing and
performance.</p></li>
<li><p><strong><code>run_all</code></strong>: If <code>TRUE</code>, all
methods will be run regardless of <code>method</code>
parameter.</p></li>
<li><p><strong><code>return_all</code></strong>: If <code>TRUE</code>,
results from all methods are returned (useful for method
comparison).</p></li>
</ul>
</div>
<div id="examining-results" class="section level2">
<h2>Examining Results</h2>
<p>The output from <code>compute_isotwas()</code> is an
<code>isotwas_result</code> object with several components:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Print summary</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">print</span>(isotwas_model)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># Access the comparison table (R² for each method)</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>isotwas_model<span class="sc">$</span>comparison</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co"># Access the best model</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>isotwas_model<span class="sc">$</span>best_models</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co"># Access individual transcript results</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>isotwas_model<span class="sc">$</span>best_models<span class="sc">$</span>Isoform1<span class="sc">$</span>r2</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>isotwas_model<span class="sc">$</span>best_models<span class="sc">$</span>Isoform1<span class="sc">$</span>weights</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co"># Get the full weight matrix</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>weight_mat <span class="ot">=</span> <span class="fu">get_weight_matrix</span>(isotwas_model<span class="sc">$</span>best_models)</span></code></pre></div>
</div>
<div id="converting-the-model" class="section level2">
<h2>Converting the Model</h2>
<p>We can convert the model from a list to a tibble or data.frame using
<code>convert_model()</code>:</p>
<p>Let’s take a look at what a sample model looks like:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>model_isotwas <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;model_example.RDS&quot;</span>, <span class="at">package =</span> <span class="st">&quot;isotwas&quot;</span>))</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">class</span>(model_isotwas)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;list&quot;</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="fu">length</span>(model_isotwas)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="fu">names</span>(model_isotwas)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Model&quot; &quot;R2&quot;</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>model_isotwas<span class="sc">$</span>Model[[<span class="dv">1</span>]]</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; $Transcript</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Isoform1&quot;</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; $Model</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; # A tibble: 187 × 2</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt;    SNP        Weight</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt;</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt;  1 SNP10  -0.0000957</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt;  2 SNP19  -0.00158  </span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt;  3 SNP80  -0.00375  </span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt;  4 SNP89  -0.000884 </span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt;  5 SNP94  -0.00504  </span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt;  6 SNP124  0.00586  </span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt;  7 SNP195 -0.0201   </span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="co">#&gt;  8 SNP232 -0.00627  </span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="co">#&gt;  9 SNP233  0.000960 </span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="co">#&gt; 10 SNP261 -0.00688  </span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="co">#&gt; # ℹ 177 more rows</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a><span class="co">#&gt; $R2</span></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a><span class="co">#&gt; [1] 0.3174829</span></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a><span class="co">#&gt; $P</span></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a><span class="co">#&gt; value </span></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a><span class="co">#&gt;     0 </span></span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a><span class="co">#&gt; $Pred</span></span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a><span class="co">#&gt;       IND190       IND380       IND130       IND314       IND462       IND137 </span></span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a><span class="co">#&gt; -0.395051620 -0.405521454 -0.405642239 -0.513143425 -0.219109235 -0.472395293 </span></span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a><span class="co">#&gt;       IND191       IND228       IND253       IND358       IND318         IND3 </span></span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a><span class="co">#&gt; -0.186011347 -0.047232532 -0.039820719 -0.203023847 -0.279393749 -0.177154706 </span></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a><span class="co">#&gt;        IND28       IND182        IND91       IND476       IND255       IND209 </span></span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a><span class="co">#&gt; -0.261468441 -0.572125420 -0.351933854 -0.493579401 -0.417614473 -0.059488250 </span></span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a><span class="co">#&gt;       IND135       IND223       IND340       IND120       IND115       IND391 </span></span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a><span class="co">#&gt; -0.318086976 -0.319871820 -0.135863999  0.083039071 -0.469286056 -0.281497318 </span></span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a><span class="co">#&gt;       IND304       IND163       IND386        IND69       IND121       IND269 </span></span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a><span class="co">#&gt; -0.342756842 -0.169790486 -0.552650084 -0.339994140  0.018921426 -0.359762240 </span></span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a><span class="co">#&gt;        IND24        IND31       IND349        IND32       IND332       IND495 </span></span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a><span class="co">#&gt; -0.171493417 -0.450912106 -0.411439831 -0.220513041 -0.445241556 -0.302148360 </span></span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a><span class="co">#&gt;       IND328       IND371       IND272        IND23        IND55       IND463 </span></span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a><span class="co">#&gt; -0.572640195 -0.090248595 -0.172602006 -0.107964558 -0.450873553 -0.297293819 </span></span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a><span class="co">#&gt;       IND194       IND441       IND113        IND47       IND502       IND409 </span></span>
<span id="cb7-51"><a href="#cb7-51" tabindex="-1"></a><span class="co">#&gt;  0.002500033 -0.082561510 -0.053926154  0.014315858 -0.263294983 -0.424747059 </span></span>
<span id="cb7-52"><a href="#cb7-52" tabindex="-1"></a><span class="co">#&gt;        IND82        IND48       IND303       IND176       IND393        IND52 </span></span>
<span id="cb7-53"><a href="#cb7-53" tabindex="-1"></a><span class="co">#&gt; -0.215259827 -0.180472021 -0.566428240 -0.154369420 -0.292469824 -0.125122866 </span></span>
<span id="cb7-54"><a href="#cb7-54" tabindex="-1"></a><span class="co">#&gt;       IND458       IND426        IND15        IND10       IND211       IND244 </span></span>
<span id="cb7-55"><a href="#cb7-55" tabindex="-1"></a><span class="co">#&gt; -0.297137749 -0.571241703 -0.271153164 -0.372562537 -0.139310663  0.058872696 </span></span>
<span id="cb7-56"><a href="#cb7-56" tabindex="-1"></a><span class="co">#&gt;        IND65        IND50       IND442       IND213       IND157       IND300 </span></span>
<span id="cb7-57"><a href="#cb7-57" tabindex="-1"></a><span class="co">#&gt; -0.353977257 -0.370280430 -0.369661968 -0.308463656 -0.015128680 -0.372327867 </span></span>
<span id="cb7-58"><a href="#cb7-58" tabindex="-1"></a><span class="co">#&gt;        IND25       IND254        IND49       IND199       IND189       IND295 </span></span>
<span id="cb7-59"><a href="#cb7-59" tabindex="-1"></a><span class="co">#&gt; -0.294685131  0.207142198 -0.265891894 -0.210070398 -0.125493031 -0.208084001 </span></span>
<span id="cb7-60"><a href="#cb7-60" tabindex="-1"></a><span class="co">#&gt;        IND88       IND459       IND339        IND46       IND325       IND419 </span></span>
<span id="cb7-61"><a href="#cb7-61" tabindex="-1"></a><span class="co">#&gt; -0.188952067 -0.341369214 -0.323699038 -0.194042453 -0.177038660  0.040164417 </span></span>
<span id="cb7-62"><a href="#cb7-62" tabindex="-1"></a><span class="co">#&gt;       IND302       IND216       IND178       IND282       IND186       IND239 </span></span>
<span id="cb7-63"><a href="#cb7-63" tabindex="-1"></a><span class="co">#&gt; -0.388742683 -0.144205644 -0.215211141 -0.347436381  0.070054061 -0.016246983 </span></span>
<span id="cb7-64"><a href="#cb7-64" tabindex="-1"></a><span class="co">#&gt;        IND89        IND71        IND33       IND494       IND369       IND109 </span></span>
<span id="cb7-65"><a href="#cb7-65" tabindex="-1"></a><span class="co">#&gt; -0.558938422 -0.009956788 -0.518804964 -0.397442503 -0.462158482 -0.620882241 </span></span>
<span id="cb7-66"><a href="#cb7-66" tabindex="-1"></a><span class="co">#&gt;        IND64       IND364         IND1       IND323        IND60       IND151 </span></span>
<span id="cb7-67"><a href="#cb7-67" tabindex="-1"></a><span class="co">#&gt; -0.470768744 -0.505031962 -0.474205183 -0.369106906 -0.183303208 -0.474395370 </span></span>
<span id="cb7-68"><a href="#cb7-68" tabindex="-1"></a><span class="co">#&gt;       IND293       IND437        IND85       IND324       IND375       IND423 </span></span>
<span id="cb7-69"><a href="#cb7-69" tabindex="-1"></a><span class="co">#&gt; -0.216436666 -0.452684526 -0.437603184 -0.588708106 -0.588703304 -0.443682464 </span></span>
<span id="cb7-70"><a href="#cb7-70" tabindex="-1"></a><span class="co">#&gt;       IND367       IND516        IND95       IND461       IND451        IND76 </span></span>
<span id="cb7-71"><a href="#cb7-71" tabindex="-1"></a><span class="co">#&gt; -0.601498157 -0.233798606 -0.410275308 -0.511844894 -0.326213821 -0.370696978 </span></span>
<span id="cb7-72"><a href="#cb7-72" tabindex="-1"></a><span class="co">#&gt;       IND298       IND310       IND222       IND102       IND491       IND422 </span></span>
<span id="cb7-73"><a href="#cb7-73" tabindex="-1"></a><span class="co">#&gt; -0.502436692 -0.408828852 -0.111287912 -0.226551260 -0.223498530  0.158679573 </span></span>
<span id="cb7-74"><a href="#cb7-74" tabindex="-1"></a><span class="co">#&gt;       IND351       IND309       IND277       IND214         IND0       IND438 </span></span>
<span id="cb7-75"><a href="#cb7-75" tabindex="-1"></a><span class="co">#&gt; -0.344041151 -0.424716100 -0.612379239 -0.231148880 -0.417714624 -0.438855224 </span></span>
<span id="cb7-76"><a href="#cb7-76" tabindex="-1"></a><span class="co">#&gt;       IND453       IND400       IND443       IND227       IND331       IND169 </span></span>
<span id="cb7-77"><a href="#cb7-77" tabindex="-1"></a><span class="co">#&gt; -0.594149200 -0.385144435 -0.456708590 -0.532575545 -0.315295504 -0.235696550 </span></span>
<span id="cb7-78"><a href="#cb7-78" tabindex="-1"></a><span class="co">#&gt;       IND197       IND142       IND416        IND51       IND346        IND27 </span></span>
<span id="cb7-79"><a href="#cb7-79" tabindex="-1"></a><span class="co">#&gt; -0.298466128  0.034104976 -0.526523901  0.508010660 -0.126042297 -0.128398444 </span></span>
<span id="cb7-80"><a href="#cb7-80" tabindex="-1"></a><span class="co">#&gt;       IND297       IND479       IND488       IND290        IND44       IND308 </span></span>
<span id="cb7-81"><a href="#cb7-81" tabindex="-1"></a><span class="co">#&gt; -0.259539348 -0.454747553 -0.504412520 -0.510470021 -0.142340184  0.072124794 </span></span>
<span id="cb7-82"><a href="#cb7-82" tabindex="-1"></a><span class="co">#&gt;       IND486         IND7       IND284       IND444       IND220       IND374 </span></span>
<span id="cb7-83"><a href="#cb7-83" tabindex="-1"></a><span class="co">#&gt; -0.329956853 -0.350941227 -0.163496962 -0.413414477 -0.593246582 -0.818095517 </span></span>
<span id="cb7-84"><a href="#cb7-84" tabindex="-1"></a><span class="co">#&gt;       IND500        IND11       IND354       IND246       IND439       IND392 </span></span>
<span id="cb7-85"><a href="#cb7-85" tabindex="-1"></a><span class="co">#&gt; -0.501920608 -0.214219476  0.007729149 -0.275404004 -0.644399750 -0.285348795 </span></span>
<span id="cb7-86"><a href="#cb7-86" tabindex="-1"></a><span class="co">#&gt;       IND448       IND506       IND192       IND484       IND203       IND452 </span></span>
<span id="cb7-87"><a href="#cb7-87" tabindex="-1"></a><span class="co">#&gt; -0.492513383 -0.310190245 -0.024709405 -0.435482280 -0.269321957 -0.552898172 </span></span>
<span id="cb7-88"><a href="#cb7-88" tabindex="-1"></a><span class="co">#&gt;        IND92       IND134       IND287       IND424       IND307       IND122 </span></span>
<span id="cb7-89"><a href="#cb7-89" tabindex="-1"></a><span class="co">#&gt; -0.101055241  0.008905316 -0.306358542 -0.461001763 -0.356879362  0.058371001 </span></span>
<span id="cb7-90"><a href="#cb7-90" tabindex="-1"></a><span class="co">#&gt;       IND414       IND212        IND20       IND127       IND236       IND258 </span></span>
<span id="cb7-91"><a href="#cb7-91" tabindex="-1"></a><span class="co">#&gt; -0.311646715 -0.111162671 -0.193471243  0.028880043 -0.407672480  0.142610577 </span></span>
<span id="cb7-92"><a href="#cb7-92" tabindex="-1"></a><span class="co">#&gt;       IND305       IND268       IND513       IND496       IND147       IND322 </span></span>
<span id="cb7-93"><a href="#cb7-93" tabindex="-1"></a><span class="co">#&gt; -0.340565157 -0.471679317 -0.404866473 -0.395120760 -0.072070907 -0.277843970 </span></span>
<span id="cb7-94"><a href="#cb7-94" tabindex="-1"></a><span class="co">#&gt;        IND45        IND68       IND201       IND348        IND43        IND75 </span></span>
<span id="cb7-95"><a href="#cb7-95" tabindex="-1"></a><span class="co">#&gt;  0.035081966 -0.363338384 -0.652974372 -0.412158936 -0.071163309 -0.080312324 </span></span>
<span id="cb7-96"><a href="#cb7-96" tabindex="-1"></a><span class="co">#&gt;        IND90        IND41       IND387       IND276       IND465       IND224 </span></span>
<span id="cb7-97"><a href="#cb7-97" tabindex="-1"></a><span class="co">#&gt;  0.025514564 -0.323200418 -0.477190145 -0.154720858 -0.341964318 -0.196673915 </span></span>
<span id="cb7-98"><a href="#cb7-98" tabindex="-1"></a><span class="co">#&gt;       IND481       IND143       IND226       IND480       IND126       IND498 </span></span>
<span id="cb7-99"><a href="#cb7-99" tabindex="-1"></a><span class="co">#&gt; -0.663275058 -0.056703898 -0.082764588 -0.210979906  0.048488465 -0.283945815 </span></span>
<span id="cb7-100"><a href="#cb7-100" tabindex="-1"></a><span class="co">#&gt;       IND233       IND195        IND61       IND173        IND97       IND478 </span></span>
<span id="cb7-101"><a href="#cb7-101" tabindex="-1"></a><span class="co">#&gt; -0.266472867 -0.217675991  0.014263476 -0.454493334 -0.550484287 -0.041911623 </span></span>
<span id="cb7-102"><a href="#cb7-102" tabindex="-1"></a><span class="co">#&gt;        IND18       IND397       IND180       IND315       IND338       IND359 </span></span>
<span id="cb7-103"><a href="#cb7-103" tabindex="-1"></a><span class="co">#&gt; -0.330665666 -0.436392508 -0.609082779 -0.569036586 -0.212491654 -0.343991921 </span></span>
<span id="cb7-104"><a href="#cb7-104" tabindex="-1"></a><span class="co">#&gt;       IND508       IND101       IND232       IND454       IND145       IND370 </span></span>
<span id="cb7-105"><a href="#cb7-105" tabindex="-1"></a><span class="co">#&gt; -0.477263014 -0.464338378 -0.072071562 -0.227516541 -0.389293368 -0.173894914 </span></span>
<span id="cb7-106"><a href="#cb7-106" tabindex="-1"></a><span class="co">#&gt;       IND159        IND12        IND77       IND421       IND112       IND289 </span></span>
<span id="cb7-107"><a href="#cb7-107" tabindex="-1"></a><span class="co">#&gt;  0.119232022 -0.094999753 -0.481360824 -0.433878747 -0.100941994 -0.581080319 </span></span>
<span id="cb7-108"><a href="#cb7-108" tabindex="-1"></a><span class="co">#&gt;       IND353       IND235        IND29       IND221       IND335       IND249 </span></span>
<span id="cb7-109"><a href="#cb7-109" tabindex="-1"></a><span class="co">#&gt; -0.332866777 -0.078403530 -0.340509458 -0.130391230 -0.223907121 -0.298415252 </span></span>
<span id="cb7-110"><a href="#cb7-110" tabindex="-1"></a><span class="co">#&gt;        IND84       IND296       IND183       IND344       IND259       IND384 </span></span>
<span id="cb7-111"><a href="#cb7-111" tabindex="-1"></a><span class="co">#&gt; -0.199496411 -0.410031721 -0.377059571 -0.693998245 -0.370623474 -0.246649423 </span></span>
<span id="cb7-112"><a href="#cb7-112" tabindex="-1"></a><span class="co">#&gt;       IND148       IND485       IND264        IND54       IND119       IND146 </span></span>
<span id="cb7-113"><a href="#cb7-113" tabindex="-1"></a><span class="co">#&gt; -0.271335029 -0.225853454 -0.261874967  0.087807798 -0.158416463 -0.214176185 </span></span>
<span id="cb7-114"><a href="#cb7-114" tabindex="-1"></a><span class="co">#&gt;        IND93        IND80        IND16       IND350       IND503       IND490 </span></span>
<span id="cb7-115"><a href="#cb7-115" tabindex="-1"></a><span class="co">#&gt; -0.420587615 -0.521984344 -0.070014457 -0.477095206 -0.366749255 -0.412342395 </span></span>
<span id="cb7-116"><a href="#cb7-116" tabindex="-1"></a><span class="co">#&gt;       IND270        IND70       IND385       IND433       IND428       IND280 </span></span>
<span id="cb7-117"><a href="#cb7-117" tabindex="-1"></a><span class="co">#&gt; -0.502675568 -0.087020068 -0.312957603 -0.141636588 -0.630821691 -0.190763136 </span></span>
<span id="cb7-118"><a href="#cb7-118" tabindex="-1"></a><span class="co">#&gt;       IND234       IND104       IND155       IND417       IND207        IND67 </span></span>
<span id="cb7-119"><a href="#cb7-119" tabindex="-1"></a><span class="co">#&gt; -0.145463209 -0.065338172 -0.102717325 -0.406053957 -0.487929907 -0.542512235 </span></span>
<span id="cb7-120"><a href="#cb7-120" tabindex="-1"></a><span class="co">#&gt;       IND471         IND6       IND413       IND412       IND245        IND96 </span></span>
<span id="cb7-121"><a href="#cb7-121" tabindex="-1"></a><span class="co">#&gt;  0.034250790 -0.327396727 -0.497126708 -0.185326538 -0.331678057 -0.078888704 </span></span>
<span id="cb7-122"><a href="#cb7-122" tabindex="-1"></a><span class="co">#&gt;        IND63       IND301       IND401       IND263       IND352       IND316 </span></span>
<span id="cb7-123"><a href="#cb7-123" tabindex="-1"></a><span class="co">#&gt; -0.238519359 -0.297359129 -0.424067348 -0.282617895 -0.050625075 -0.255118778 </span></span>
<span id="cb7-124"><a href="#cb7-124" tabindex="-1"></a><span class="co">#&gt;       IND341       IND489       IND388       IND457       IND181       IND431 </span></span>
<span id="cb7-125"><a href="#cb7-125" tabindex="-1"></a><span class="co">#&gt; -0.459988827 -0.313308038 -0.311893938  0.040361232 -0.454678575 -0.575772676 </span></span>
<span id="cb7-126"><a href="#cb7-126" tabindex="-1"></a><span class="co">#&gt;       IND140       IND512       IND330       IND420       IND377       IND139 </span></span>
<span id="cb7-127"><a href="#cb7-127" tabindex="-1"></a><span class="co">#&gt; -0.218079182 -0.400390897 -0.392403815 -0.258866066 -0.353999148  0.032783885 </span></span>
<span id="cb7-128"><a href="#cb7-128" tabindex="-1"></a><span class="co">#&gt;       IND171       IND165       IND395       IND436       IND475       IND167 </span></span>
<span id="cb7-129"><a href="#cb7-129" tabindex="-1"></a><span class="co">#&gt;  0.002110163 -0.083110045 -0.540800075 -0.680934271 -0.444409304 -0.160315170 </span></span>
<span id="cb7-130"><a href="#cb7-130" tabindex="-1"></a><span class="co">#&gt;       IND111       IND473       IND379       IND501       IND164       IND360 </span></span>
<span id="cb7-131"><a href="#cb7-131" tabindex="-1"></a><span class="co">#&gt; -0.189364791 -0.415996781 -0.534266922 -0.437482227 -0.269667607 -0.244362503 </span></span>
<span id="cb7-132"><a href="#cb7-132" tabindex="-1"></a><span class="co">#&gt;       IND390       IND376       IND425        IND66       IND243        IND39 </span></span>
<span id="cb7-133"><a href="#cb7-133" tabindex="-1"></a><span class="co">#&gt; -0.016687981 -0.300365083 -0.559132052 -0.397677303 -0.253962997 -0.157969029 </span></span>
<span id="cb7-134"><a href="#cb7-134" tabindex="-1"></a><span class="co">#&gt;       IND125        IND59       IND218       IND361       IND469       IND321 </span></span>
<span id="cb7-135"><a href="#cb7-135" tabindex="-1"></a><span class="co">#&gt;  0.198755812 -0.270404134 -0.157473118 -0.435929952 -0.198513588 -0.471754809</span></span></code></pre></div>
<p>This model object is a list with a <code>Model</code> and a
<code>R2</code> slot. The <code>Model</code> slot stores a list of
models for each isoform.</p>
<p>We can convert this model from a list to a <code>tibble</code> using
the <code>convert_model()</code> function. Make sure you have an
annotation object to have position and REF/ALT allele information.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>model_tsv <span class="ot">=</span> <span class="fu">convert_model</span>(model_isotwas,</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>                          <span class="at">snp_annot =</span> snps<span class="sc">$</span>map,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>                          <span class="at">snp_var =</span> <span class="st">&#39;marker.ID&#39;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>model_tsv</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; # A tibble: 700 × 10</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt;    SNP        Weight Transcript    R2  R2.P chromosome genetic.dist physical.pos</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;      &lt;int&gt;        &lt;int&gt;        &lt;int&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt;  1 SNP10    -9.57e-5 Isoform1   0.317     0          1            0        10099</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt;  2 SNP100   -2.42e-3 Isoform3   0.425     0          1            0       100107</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt;  3 SNP1009   2.15e-3 Isoform3   0.425     0          1            0      1009108</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt;  4 SNP101    8.68e-3 Isoform2   0.463     0          1            0       101086</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt;  5 SNP1012  -1.99e-2 Isoform1   0.317     0          1            0      1012093</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt;  6 SNP1017  -7.31e-3 Isoform2   0.463     0          1            0      1017093</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt;  7 SNP1020   4.89e-3 Isoform2   0.463     0          1            0      1020103</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt;  8 SNP1025   3.36e-2 Isoform1   0.317     0          1            0      1025113</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt;  9 SNP103   -5.00e-2 Isoform2   0.463     0          1            0       103078</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt; 10 SNP1042  -1.09e-2 Isoform2   0.463     0          1            0      1042088</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; # ℹ 690 more rows</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: allele1 &lt;chr&gt;, allele2 &lt;chr&gt;</span></span></code></pre></div>
</div>
<div id="method-recommendations" class="section level2">
<h2>Method Recommendations</h2>
<p>Based on simulations and real data analyses:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Default recommendation</strong>: Use
<code>run_all = TRUE</code> to evaluate all methods and let the function
select the best model based on cross-validated R².</p></li>
<li><p><strong>For speed</strong>: If computation time is a concern,
start with <code>c(&#39;multi_enet&#39;, &#39;sgl&#39;, &#39;univariate&#39;)</code> which
provides a good balance of multivariate and univariate
approaches.</p></li>
<li><p><strong>When isoforms share structure</strong>: Use
<code>graph_reg</code> with a similarity matrix derived from shared
exons. This helps when isoforms have correlated genetic effects due to
shared regulatory regions.</p></li>
<li><p><strong>For robust predictions</strong>: The
<code>stacking</code> method combines multiple base methods and often
provides stable predictions, especially when different methods perform
well for different isoforms.</p></li>
<li><p><strong>For joint feature selection</strong>: Use
<code>mtlasso</code> or <code>sgl</code> when you expect SNPs to affect
multiple isoforms simultaneously.</p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
