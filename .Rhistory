setwd('extdata/')
snps = snp_attach(snp_readBed2('example.bed',
backingfile = tempfile()))
dim(snps$fam)
train = sample(1:nrow(snps$fam),
300)
test = (1:nrow(snps$fam))[-train]
snp_train = snp_attach(subset(snps,
ind.row = train))
snp_ld = snp_attach(subset(snps,
ind.row = test))
bigsnpr::snp_writeBed(snp_train,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/train.bed')
bigsnpr::snp_writeBed(snp_ld,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/ld.bed')
set.seed(1789)
isoform_mat = matrix(nrow = nrow(snp_train$fam),
ncol = 3)
effects = rnorm(k*p, mean = 0, sd = 0.05)
effects[rbinom(k*p,1,0.01) != 1] = 0
b_isoqtl = matrix(effects, nrow = nrow(snp_train$map))
nrow(snp_train$map)
set.seed(1789)
k = nrow(snp_train$map)
n = nrow(snp_train$fam)
p = 3
isoform_mat = matrix(nrow = n,
ncol = p)
effects = rnorm(k*p, mean = 0, sd = 0.05)
effects[rbinom(k*p,1,0.01) != 1] = 0
b_isoqtl = matrix(effects, nrow = k)
isoform_mat = gen_mat %*% b_isoqtl
isoform_mat = snp_train$genotypes[] %*% b_isoqtl
rownames(isoform_mat) = paste0('Sample',1:n)
colnames(isoform_mat) = paste0('Isoform',1:p)
dim(isoform_mat)
set.seed(1789)
k = nrow(snp_train$map)
n = nrow(snp_train$fam)
p = 3
isoform_mat = matrix(nrow = n,
ncol = p)
effects = rnorm(k*p, mean = 0, sd = 0.05)
effects[rbinom(k*p,1,0.03) != 1] = 0
b_isoqtl = matrix(effects, nrow = k)
isoform_mat = snp_train$genotypes[] %*% b_isoqtl
rownames(isoform_mat) = paste0('Sample',1:n)
colnames(isoform_mat) = paste0('Isoform',1:p)
dim(isoform_mat)
set.seed(1789)
k = nrow(snp_train$map)
n = nrow(snp_train$fam)
p = 3
isoform_mat = matrix(nrow = n,
ncol = p)
effects = rnorm(k*p, mean = 0, sd = 0.05)
effects[rbinom(k*p,1,0.03) != 1] = 0
b_isoqtl = matrix(effects, nrow = k)
isoform_mat = snp_train$genotypes[] %*% b_isoqtl + matrix(rnorm(k*p,0,0.05),
nrow = k)
dim(snp_train$genotypes[] %*% b_isoqtl)
dim(matrix(rnorm(k*p,0,0.05),
nrow = k))
isoform_mat = (snp_train$genotypes[] %*% b_isoqtl) + matrix(rnorm(n*p,0,0.05),
nrow = n)
dim(isoform_mat)
set.seed(1789)
k = nrow(snp_train$map)
n = nrow(snp_train$fam)
p = 3
isoform_mat = matrix(nrow = n,
ncol = p)
effects = rnorm(k*p, mean = 0, sd = 0.05)
effects[rbinom(k*p,1,0.03) != 1] = 0
b_isoqtl = matrix(effects, nrow = k)
isoform_mat = (snp_train$genotypes[] %*% b_isoqtl) + matrix(rnorm(n*p,0,0.05),
nrow = n)
rownames(isoform_mat) = paste0('Sample',1:n)
colnames(isoform_mat) = paste0('Isoform',1:p)
dim(isoform_mat)
isoform_mat
saveRDS(isoform_mat,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/isoform_exp.RDS')
snp_train$map
gwas = data.frame(SNP = snp_train$map$marker.ID,
Chromosome = 1,
Position = snp_train$map$physical.pos,
A1 = snp_train$map$allele1,
A2 = snp_train$map$allele2,
Beta = rnorm(nrow(snp_train$map)),
SE = rnorm(nrow(snp_train$map),
0,0.5))
gwas
gwas$Z = gwas$Beta/gwas$SE
max(abs(gwas$Z))
gwas$Z
gwas = data.frame(SNP = snp_train$map$marker.ID,
Chromosome = 1,
Position = snp_train$map$physical.pos,
A1 = snp_train$map$allele1,
A2 = snp_train$map$allele2,
Beta = rnorm(nrow(snp_train$map)),
SE = rnorm(nrow(snp_train$map),
0,2))
gwas
gwas$Z = gwas$Beta/gwas$SE
max(abs(gwas$Z))
gwas = data.frame(SNP = snp_train$map$marker.ID,
Chromosome = 1,
Position = snp_train$map$physical.pos,
A1 = snp_train$map$allele1,
A2 = snp_train$map$allele2,
Z = rnorm(nrow(snp_train_map))
Beta = rnorm(nrow(snp_train$map)))
gwas = data.frame(SNP = snp_train$map$marker.ID,
Chromosome = 1,
Position = snp_train$map$physical.pos,
A1 = snp_train$map$allele1,
A2 = snp_train$map$allele2,
Z = rnorm(nrow(snp_train_map)),
Beta = rnorm(nrow(snp_train$map)))
gwas = data.frame(SNP = snp_train$map$marker.ID,
Chromosome = 1,
Position = snp_train$map$physical.pos,
A1 = snp_train$map$allele1,
A2 = snp_train$map$allele2,
Z = rnorm(nrow(snp_train$map)),
Beta = rnorm(nrow(snp_train$map)))
gwas$SE = gwas$Z/gwas$Beta
gwas
gwas$Z == gwas$Beta/gwas$SE
require(bigsnpr)
setwd('/Library/Frameworks/R.framework/Versions/4.1/Resources/library')
setwd('bigsnpr/')
setwd('extdata/')
snps = snp_attach(snp_readBed2('example.bed',
backingfile = tempfile()))
dim(snps$fam)
train = sample(1:nrow(snps$fam),
300)
test = (1:nrow(snps$fam))[-train]
snp_train = snp_attach(subset(snps,
ind.row = train))
snp_ld = snp_attach(subset(snps,
ind.row = test))
bigsnpr::snp_writeBed(snp_train,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/train.bed')
bigsnpr::snp_writeBed(snp_ld,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/ld.bed')
set.seed(1789)
k = nrow(snp_train$map)
n = nrow(snp_train$fam)
p = 3
isoform_mat = matrix(nrow = n,
ncol = p)
effects = rnorm(k*p, mean = 0, sd = 0.05)
effects[rbinom(k*p,1,0.03) != 1] = 0
b_isoqtl = matrix(effects, nrow = k)
isoform_mat = (snp_train$genotypes[] %*% b_isoqtl) + matrix(rnorm(n*p,0,0.05),
nrow = n)
rownames(isoform_mat) = paste0('Sample',1:n)
colnames(isoform_mat) = paste0('Isoform',1:p)
dim(isoform_mat)
saveRDS(isoform_mat,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/isoform_exp.RDS')
gwas = data.frame(SNP = snp_train$map$marker.ID,
Chromosome = 1,
Position = snp_train$map$physical.pos,
A1 = snp_train$map$allele1,
A2 = snp_train$map$allele2,
Z = rnorm(nrow(snp_train$map)),
Beta = rnorm(nrow(snp_train$map)))
gwas$SE = (gwas$Z/gwas$Beta)^-1
gwas
gwas = data.frame(SNP = snp_train$map$marker.ID,
Chromosome = 1,
Position = snp_train$map$physical.pos,
A1 = snp_train$map$allele1,
A2 = snp_train$map$allele2,
Z = rnorm(nrow(snp_train$map)),
SE = abs(rnorm(nrow(snp_train$map),
0,0.02)))
gwas
require(bigsnpr)
setwd('/Library/Frameworks/R.framework/Versions/4.1/Resources/library')
setwd('bigsnpr/')
setwd('extdata/')
snps = snp_attach(snp_readBed2('example.bed',
backingfile = tempfile()))
dim(snps$fam)
train = sample(1:nrow(snps$fam),
300)
test = (1:nrow(snps$fam))[-train]
snp_train = snp_attach(subset(snps,
ind.row = train))
snp_ld = snp_attach(subset(snps,
ind.row = test))
bigsnpr::snp_writeBed(snp_train,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/train.bed')
bigsnpr::snp_writeBed(snp_ld,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/ld.bed')
set.seed(1789)
k = nrow(snp_train$map)
n = nrow(snp_train$fam)
p = 3
isoform_mat = matrix(nrow = n,
ncol = p)
effects = rnorm(k*p, mean = 0, sd = 0.05)
effects[rbinom(k*p,1,0.03) != 1] = 0
b_isoqtl = matrix(effects, nrow = k)
isoform_mat = (snp_train$genotypes[] %*% b_isoqtl) + matrix(rnorm(n*p,0,0.05),
nrow = n)
rownames(isoform_mat) = paste0('Sample',1:n)
colnames(isoform_mat) = paste0('Isoform',1:p)
dim(isoform_mat)
saveRDS(isoform_mat,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/isoform_exp.RDS')
gwas = data.frame(SNP = snp_train$map$marker.ID,
Chromosome = 1,
Position = snp_train$map$physical.pos,
A1 = snp_train$map$allele1,
A2 = snp_train$map$allele2,
Z = rnorm(nrow(snp_train$map)),
SE = abs(rnorm(nrow(snp_train$map),
0,0.02)))
gwas$Beta = gwas$Z * gwas$SE
gwas$Beta
gwas$Z
max(abs(gwas$Z))
require(bigsnpr)
setwd('/Library/Frameworks/R.framework/Versions/4.1/Resources/library')
setwd('bigsnpr/')
setwd('extdata/')
snps = snp_attach(snp_readBed2('example.bed',
backingfile = tempfile()))
dim(snps$fam)
train = sample(1:nrow(snps$fam),
300)
test = (1:nrow(snps$fam))[-train]
snp_train = snp_attach(subset(snps,
ind.row = train))
snp_ld = snp_attach(subset(snps,
ind.row = test))
bigsnpr::snp_writeBed(snp_train,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/train.bed')
bigsnpr::snp_writeBed(snp_ld,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/ld.bed')
set.seed(1789)
k = nrow(snp_train$map)
n = nrow(snp_train$fam)
p = 3
isoform_mat = matrix(nrow = n,
ncol = p)
effects = rnorm(k*p, mean = 0, sd = 0.05)
effects[rbinom(k*p,1,0.03) != 1] = 0
b_isoqtl = matrix(effects, nrow = k)
isoform_mat = (snp_train$genotypes[] %*% b_isoqtl) + matrix(rnorm(n*p,0,0.05),
nrow = n)
rownames(isoform_mat) = paste0('Sample',1:n)
colnames(isoform_mat) = paste0('Isoform',1:p)
dim(isoform_mat)
saveRDS(isoform_mat,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/isoform_exp.RDS')
gwas = data.frame(SNP = snp_train$map$marker.ID,
Chromosome = 1,
Position = snp_train$map$physical.pos,
A1 = snp_train$map$allele1,
A2 = snp_train$map$allele2,
Z = rnorm(nrow(snp_train$map),0,2),
SE = abs(rnorm(nrow(snp_train$map),
0,0.02)))
gwas$Z
max(abs(gwas$Z))
b_isoqtl
require(bigsnpr)
setwd('/Library/Frameworks/R.framework/Versions/4.1/Resources/library')
setwd('bigsnpr/')
setwd('extdata/')
snps = snp_attach(snp_readBed2('example.bed',
backingfile = tempfile()))
dim(snps$fam)
train = sample(1:nrow(snps$fam),
300)
test = (1:nrow(snps$fam))[-train]
snp_train = snp_attach(subset(snps,
ind.row = train))
snp_ld = snp_attach(subset(snps,
ind.row = test))
bigsnpr::snp_writeBed(snp_train,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/train.bed')
bigsnpr::snp_writeBed(snp_ld,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/ld.bed')
set.seed(1789)
k = nrow(snp_train$map)
n = nrow(snp_train$fam)
p = 3
isoform_mat = matrix(nrow = n,
ncol = p)
effects = rnorm(k*p, mean = 0, sd = 0.05)
effects[rbinom(k*p,1,0.03) != 1] = 0
b_isoqtl = matrix(effects, nrow = k)
isoform_mat = (snp_train$genotypes[] %*% b_isoqtl) + matrix(rnorm(n*p,0,0.05),
nrow = n)
rownames(isoform_mat) = paste0('Sample',1:n)
colnames(isoform_mat) = paste0('Isoform',1:p)
dim(isoform_mat)
saveRDS(isoform_mat,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/isoform_exp.RDS')
gwas = data.frame(SNP = snp_train$map$marker.ID,
Chromosome = 1,
Position = snp_train$map$physical.pos,
A1 = snp_train$map$allele1,
A2 = snp_train$map$allele2,
Z = rnorm(nrow(snp_train$map),0,2),
SE = abs(rnorm(nrow(snp_train$map),
0,0.02)))
require(bigsnpr)
setwd('/Library/Frameworks/R.framework/Versions/4.1/Resources/library')
setwd('bigsnpr/')
setwd('extdata/')
snps = snp_attach(snp_readBed2('example.bed',
backingfile = tempfile()))
dim(snps$fam)
train = sample(1:nrow(snps$fam),
300)
test = (1:nrow(snps$fam))[-train]
snp_train = snp_attach(subset(snps,
ind.row = train))
snp_ld = snp_attach(subset(snps,
ind.row = test))
bigsnpr::snp_writeBed(snp_train,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/train.bed')
bigsnpr::snp_writeBed(snp_ld,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/ld.bed')
set.seed(1789)
k = nrow(snp_train$map)
n = nrow(snp_train$fam)
p = 3
isoform_mat = matrix(nrow = n,
ncol = p)
effects = rnorm(k*p, mean = 0, sd = 0.05)
effects[rbinom(k*p,1,0.03) != 1] = 0
b_isoqtl = matrix(effects, nrow = k)
isoform_mat = (snp_train$genotypes[] %*% b_isoqtl) + matrix(rnorm(n*p,0,0.05),
nrow = n)
rownames(isoform_mat) = paste0('Sample',1:n)
colnames(isoform_mat) = paste0('Isoform',1:p)
dim(isoform_mat)
saveRDS(isoform_mat,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/isoform_exp.RDS')
gwas = data.frame(SNP = snp_train$map$marker.ID,
Chromosome = 1,
Position = snp_train$map$physical.pos,
A1 = snp_train$map$allele1,
A2 = snp_train$map$allele2,
Z = rnorm(nrow(snp_train$map),0,2),
SE = abs(rnorm(nrow(snp_train$map),
0,0.02)))
gwas$Beta = gwas$Z * gwas$SE
require(bigsnpr)
setwd('/Library/Frameworks/R.framework/Versions/4.1/Resources/library')
setwd('bigsnpr/')
setwd('extdata/')
snps = snp_attach(snp_readBed2('example.bed',
backingfile = tempfile()))
dim(snps$fam)
train = sample(1:nrow(snps$fam),
300)
test = (1:nrow(snps$fam))[-train]
snp_train = snp_attach(subset(snps,
ind.row = train))
snp_ld = snp_attach(subset(snps,
ind.row = test))
bigsnpr::snp_writeBed(snp_train,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/train.bed')
bigsnpr::snp_writeBed(snp_ld,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/ld.bed')
set.seed(1789)
k = nrow(snp_train$map)
n = nrow(snp_train$fam)
p = 3
isoform_mat = matrix(nrow = n,
ncol = p)
effects = rnorm(k*p, mean = 0, sd = 0.05)
effects[rbinom(k*p,1,0.03) != 1] = 0
b_isoqtl = matrix(effects, nrow = k)
isoform_mat = (snp_train$genotypes[] %*% b_isoqtl) + matrix(rnorm(n*p,0,0.05),
nrow = n)
rownames(isoform_mat) = paste0('Sample',1:n)
colnames(isoform_mat) = paste0('Isoform',1:p)
dim(isoform_mat)
saveRDS(isoform_mat,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/isoform_exp.RDS')
gwas = data.frame(SNP = snp_train$map$marker.ID,
Chromosome = 1,
Position = snp_train$map$physical.pos,
A1 = snp_train$map$allele1,
A2 = snp_train$map$allele2,
Z = rnorm(nrow(snp_train$map),0,2),
SE = abs(rnorm(nrow(snp_train$map),
0,0.02)))
gwas$Beta = gwas$Z * gwas$SE
require(bigsnpr)
setwd('/Library/Frameworks/R.framework/Versions/4.1/Resources/library')
setwd('bigsnpr/')
setwd('extdata/')
snps = snp_attach(snp_readBed2('example.bed',
backingfile = tempfile()))
dim(snps$fam)
train = sample(1:nrow(snps$fam),
300)
test = (1:nrow(snps$fam))[-train]
snp_train = snp_attach(subset(snps,
ind.row = train))
snp_ld = snp_attach(subset(snps,
ind.row = test))
bigsnpr::snp_writeBed(snp_train,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/train.bed')
bigsnpr::snp_writeBed(snp_ld,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/ld.bed')
set.seed(1789)
k = nrow(snp_train$map)
n = nrow(snp_train$fam)
p = 3
isoform_mat = matrix(nrow = n,
ncol = p)
effects = rnorm(k*p, mean = 0, sd = 0.05)
effects[rbinom(k*p,1,0.03) != 1] = 0
b_isoqtl = matrix(effects, nrow = k)
isoform_mat = (snp_train$genotypes[] %*% b_isoqtl) + matrix(rnorm(n*p,0,0.05),
nrow = n)
rownames(isoform_mat) = paste0('Sample',1:n)
colnames(isoform_mat) = paste0('Isoform',1:p)
dim(isoform_mat)
saveRDS(isoform_mat,
'/Users/arjunbhattacharya/Documents/isotwas/extdata/isoform_exp.RDS')
gwas = data.frame(SNP = snp_train$map$marker.ID,
Chromosome = 1,
Position = snp_train$map$physical.pos,
A1 = snp_train$map$allele1,
A2 = snp_train$map$allele2,
Z = rnorm(nrow(snp_train$map),0,2),
SE = abs(rnorm(nrow(snp_train$map),
0,0.02)))
gwas$Beta = gwas$Z * gwas$SE
write.table(gwas,'/Users/arjunbhattacharya/Documents/isotwas/extdata/gwas.txt',
sep='\t',colnames = T, rownames = F,quote=F)
write.table(gwas,'/Users/arjunbhattacharya/Documents/isotwas/extdata/gwas.txt',
sep='\t',col.names = T, row.names = F,quote=F)
library(isotwas)
snps = bigsnpr::snp_attach(bigsnpr::snp_readBed2('extdata/train.bed',
backingfile = tempfile()))
devtools::install_github('bhattacharya-a-bt/isotwas')
system.file("inst", "extdata", "train.bed", package = "isotwas")
system.file("extdata", "train.bed", package = "isotwas")
train_bed = system.file("extdata", "train.bed", package = "isotwas")
snps = bigsnpr::snp_attach(bigsnpr::snp_readBed2(train_bed,
backingfile = tempfile()))
snps
dim(snps$genotypes[])
tx_data = readRDS(system.file("extdata", "isoform_exp.RDS", package = "isotwas"))
dim(tx_data)
tx_data
class(tx_data)
boot_list = lapply(1:10,function(i){jitter(isoform_mat)})
isoform_mat_rep = rlist::list.rbind(boot_list)
rownames(isoform_mat_rep) = rep(paste0('Sample',1:n),10)
colnames(isoform_mat_rep) = paste0('Isoform',1:p)
dim(isoform_mat_rep)
isotwas_model = isotwas::compute_isotwas(X = snps$genotypes[],
Y = isoform_mat,
Y.rep = isoform_mat_rep,
R = 10,
id = rownames(isoform_mat_rep),
omega_est = 'replicates',
omega_nlambda = 5,
method = c('mrce_lasso',
'multi_enet',
'univariate',
'mvsusie'),
predict_nlambda = 10,
family = 'gaussian',
scale = FALSE,
alpha = 0.5,
nfolds = 5,
verbose = FALSE,
tx_names = paste0('Isoform',1:3),
seed = 1789,
run_all = FALSE,
return_all = TRUE)
require(isotwas)
isotwas_model = compute_isotwas(X = snps$genotypes[],
Y = isoform_mat,
Y.rep = isoform_mat_rep,
R = 10,
id = rownames(isoform_mat_rep),
omega_est = 'replicates',
omega_nlambda = 5,
method = c('mrce_lasso',
'multi_enet',
'univariate',
'mvsusie'),
predict_nlambda = 10,
family = 'gaussian',
scale = FALSE,
alpha = 0.5,
nfolds = 5,
verbose = FALSE,
tx_names = paste0('Isoform',1:3),
seed = 1789,
run_all = FALSE,
return_all = TRUE)
